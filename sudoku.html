<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sudoku Game</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="sudoku-page">
    <div class="sudoku-container">
        <h1>Sudoku Game</h1>
        <div id="sudoku-board">
            <table>
                <tbody>
                    <!-- Generate 9 rows and 9 columns for Sudoku -->
                    <script>
                        for (let i = 0; i < 9; i++) {
                            document.write("<tr>");
                            for (let j = 0; j < 9; j++) {
                                document.write('<td><input type="text" maxlength="1" oninput="validateInput(this)"></td>');
                            }
                            document.write("</tr>");
                        }
                    </script>
                </tbody>
            </table>
        </div>
        <div class="sudoku-buttons">
            <button onclick="generatePuzzle()">Regenerate Puzzle</button>
            <button onclick="checkSolution()">Check Solution</button>
            <button onclick="window.location.href='index.html';">Back to Main Page</button>
        </div>
    </div>

    <script>
        function isSafe(board, row, col, num) {
            for (let x = 0; x < 9; x++) {
                if (board[row][x] == num || board[x][col] == num || 
                    board[3 * Math.floor(row / 3) + Math.floor(x / 3)][3 * Math.floor(col / 3) + x % 3] == num) {
                    return false;
                }
            }
            return true;
        }

        function solveSudoku(board) {
            for (let row = 0; row < 9; row++) {
                for (let col = 0; col < 9; col++) {
                    if (board[row][col] == '') {
                        for (let num = 1; num <= 9; num++) {
                            if (isSafe(board, row, col, num)) {
                                board[row][col] = num;
                                if (solveSudoku(board)) return true;
                                board[row][col] = '';
                            }
                        }
                        return false;
                    }
                }
            }
            return true;
        }

        function createPuzzle(board, numRemove) {
            let count = numRemove;
            while (count > 0) {
                const cellId = Math.floor(Math.random() * 81);
                const row = Math.floor(cellId / 9);
                const col = cellId % 9;
                if (board[row][col] !== '') {
                    board[row][col] = '';
                    count--;
                }
            }
        }

        function generateFullBoard() {
            const board = Array.from({ length: 9 }, () => Array(9).fill(''));
            solveSudoku(board);
            return board;
        }

        function generatePuzzle() {
            const board = generateFullBoard();
            createPuzzle(board, 40);

            const inputs = document.querySelectorAll('td input');
            inputs.forEach((input, index) => {
                const row = Math.floor(index / 9);
                const col = index % 9;
                input.value = board[row][col] || '';
                if (board[row][col] !== '') {
                    input.setAttribute('readonly', true);
                    input.classList.add('prefilled');
                } else {
                    input.removeAttribute('readonly');
                    input.classList.remove('prefilled');
                }
            });
        }

        function checkSolution() {
            const inputs = document.querySelectorAll('td input');
            const board = Array.from({ length: 9 }, () => Array(9).fill(''));
            let allFilled = true;

            inputs.forEach((input, index) => {
                const row = Math.floor(index / 9);
                const col = index % 9;
                if (input.value === '') {
                    allFilled = false;
                }
                board[row][col] = input.value === '' ? '' : parseInt(input.value, 10);
            });

            if (!allFilled) {
                alert("Please fill in all the cells before checking the solution.");
                return;
            }

            if (validateSudoku(board)) {
                alert("Congratulations! You solved the Sudoku!");
            } else {
                alert("The solution is incorrect. Please try again.");
            }
        }

        function validateSudoku(board) {
            for (let i = 0; i < 9; i++) {
                const rowSet = new Set();
                const colSet = new Set();
                for (let j = 0; j < 9; j++) {
                    if (board[i][j] !== '' && rowSet.has(board[i][j])) return false;
                    if (board[j][i] !== '' && colSet.has(board[j][i])) return false;
                    rowSet.add(board[i][j]);
                    colSet.add(board[j][i]);
                }
            }

            for (let row = 0; row < 9; row += 3) {
                for (let col = 0; col < 9; col += 3) {
                    const gridSet = new Set();
                    for (let i = 0; i < 3; i++) {
                        for (let j = 0; j < 3; j++) {
                            const value = board[row + i][col + j];
                            if (value !== '' && gridSet.has(value)) return false;
                            gridSet.add(value);
                        }
                    }
                }
            }
            return true;
        }

        function validateInput(input) {
            input.value = input.value.replace(/[^1-9]/g, ''); // Restrict input to numbers 1-9
        }

        window.onload = generatePuzzle;
    </script>
</body>
</html>